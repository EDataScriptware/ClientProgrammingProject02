<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Riley Version</title>
  <link rel="stylesheet" type="text/css" href="css/styles.css">

  <script src="https://code.jquery.com/jquery-latest.js" type="text/javascript">
</script>
<script type="text/javascript">
	// P2 Start
	//now what?
	//api:  http://www.ist.rit.edu/api/
	$(document).ready(function(){
		
		// get the /about/ information onto the page
		myXHR('get',{'path':'/about/'}).done(function(json){
			var x = '<h2>'+json.title+'</h2>';
			x+='<p>'+json.description+'</p>';
			x+='<p>'+json.quote+'</p>';
			x+='<p>'+json.quoteAuthor+'</p>';
		
			// add this 'x' to the page
			$('#about').html(x);
		}); // end /about/
		
		// degrees undergraudate
		
		myXHR('get',{'path':'/degrees/undergraduate/'}).done(function(json){
			console.log(json);
			
			var x='';
			
			$.each(json.undergraduate,function(i,item){
				console.log(i+' = '+item);
				
				x+='<h2>'+item.title+' ('+item.degreeName+')</h2>';
				x+='<p>'+item.description+'</p>';
				
				var y='<ul>';
				$.each(item.concentrations,function(j,jtem){
					y+='<li>'+jtem+'</li>';
				});
				y+='</ul>';
				
				x+=y;		// add the concentrations to the program information				
				
				$('#content').html(x);
			});
			
		
		
		}); // end degrees/undergraduate/

		// ------------------------------------------------------------

		// PEOPLE
		myXHR('get',{'path':'/people/faculty'}).done(function(json){
			var x = '';
			$.each(json.faculty, function(k, ktem){
				console.log(k + ' -- ' + ktem)


				x += '<div onclick="facMore(this)"';
				x += ' data-id="' + $(this)[0].username + '"';
				x += 'style ="cursor:pointer;">';
				x += '<h2>' + $(this)[0].name + '</h2>';
				x += '<p>' + $(this)[0].title + '</p>';
				x += '<img src = "' + $(this)[0].imagePath + '"/>';
				x += '<hr/>';

				x += "</div>";
			})
			$('#people').html(x);

		}); // end people/faculty

		
		
	});	// end document ready
	
	function facMore ( who ){
		var id = $(who).attr('data-id');
myXHR('get',{'path':'/people/faculty/username=' + id}).done(function(json){

	console.log('facMore = ' + json.interestArea);	
	}) // end path


} // end facMore
	
	// AJAX function to get information 
	// XHR is XML HTTP Request
	// t = get or post
	// d = path : /about/
	function myXHR(t,d){
		return $.ajax({
			type: t,
			cache: false,
			async: true,
			dataType:'json',
			url:'proxy.php',
			data:d,
			beforeSend:function(){
				// do this before sending the request
				$('<img src="gears.gif" id="spinner" '+
					'style="position:relative;top:50px;left:50px;z-index:2000"/>')
					.appendTo("body");
			}
		}).always(function(){
			// happens at the end, no matter what
			$('#spinner').remove();
		}).fail(function(){
			// if our request doesn't work
			console.log('Failure with '+d.path);
		});
	} // end myXHR
	

</script>
</head>
<body>
  <h1>IST Dept Site</h1>
	<section id="people"></section>
  
	<section id="content"></section>
	
	<section id="about"></section>

</body>
</html>
